{
    # vim: ft=perl:

    $haveSSL = (exists ${modSSL}{status} and ${modSSL}{status} eq "enabled") ?  'yes' : 'no';

    $OUT = '';
    if ((${'shellinaboxd'}{'status'} || 'disabled') eq 'enabled' &&
        (${'httpd-shell'}{'status'} || 'disabled') eq 'enabled'){

		$OUT .= "    RewriteRule ^/shell(/.*|\$)    https://%{HTTP_HOST}/shell\$1 [L,R]\n";

        if (($port eq "80") && ($haveSSL eq 'yes')){
            $OUT .= "    RewriteRule ^/shell(/.*|\$)    https://%{HTTP_HOST}/shell\$1 [L,R]\n";
        }
        else{
            $OUT .= "    ProxyPass /shell http://127.0.0.1:${'httpd-shell'}{TCPPort}/shell\n";
            $OUT .= "    ProxyPassReverse /shell http://127.0.0.1:${'httpd-shell'}{TCPPort}/shell\n";
        }

        $OUT .=<<"HERE";

    <Location /shell>
        SSLRequireSSL on
        order deny,allow
        deny from all
        allow from $localAccess $externalSSLAccess
    </Location>

HERE
    }
}
